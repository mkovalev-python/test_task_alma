# Тестовое задание
##  Микросервис по расчету промысловых показателей
#### Задача:
___
    Необходимо создать сервис для вызова некоторого расчета (kernel.py) и хранения результатов. Результаты расчетов должны храниться в базе данных. Сервис должен предоставлять API, работающее поверх HTTP в формате JSON. 
    В расчет передаются параметры date_start (формат "ГГГГ-ММ-ДД"), date_fin (формат "ГГГГ-ММ-ДД"), lag (целое число).
    Результатом расчета является DataFrame с полями 'date' (формат "ГГГГ-ММ-ДД"), 'liquid' (вещественное число), 'oil' (вещественное число), 'water' (вещественное число), 'wct' (вещественное число).
    Требования
    •	Язык программирования python — очень желательно, так как это основной язык для нас;
    •	Предусмотреть очередь запусков, чтобы можно было запустить несколько расчетов друг за другом;
    •	Финальную версию сделать с возможностью запустить через Docker и передать через архив с инструкцией по установке;
    •	Простая инструкция для запуска;
    •	3 метода: получение списка последних 10 запусков расчетов, получение одного расчета, создание расчета;
    •	Валидация полей в передаваемых параметрах
    Если есть сомнения по деталям — решение принять самостоятельно, но в своём README.md рекомендуем выписать вопросы и принятые решения по ним. Разрешается менять модуль расчета kernel.py, без изменения структуры выходного результата (5 столбцов в таблице).
    Детали
    Метод получения списка последних 10 запусков расчетов
    •	Пагинация: на одной странице должно присутствовать 10 расчетов;
    •	Сортировки: по дате запуска (возрастание/убывание);
    •	Поля в ответе: название расчета, дата запуска, статус (завершен, идет расчет, в очереди).
    Метод получения конкретного расчета
    •	Обязательные поля в ответе: все поля возвращаемого датафрейма, дата запуска, статус. Если расчёт еще не окончен, то ответ = None. Результат должен быть сериализован в JSON, для дальнейшей возможности передачи на фронт.
    •	Опциональные поля (можно запросить, передав параметр fields): название расчета, время затраченное на расчет.
    Метод создания расчета:
    •	Принимает все вышеперечисленные поля: date_start, date_fin, lag;
    •	Возвращает ID созданного расчета.
    Усложнения
    Не обязательно, но задание может быть выполнено с любым числом усложнений:
    •	Юнит тесты: постарайтесь достичь покрытия в 70% и больше;
    •	Архитектура сервиса описана в виде текста и/или диаграмм
    •	Документация: есть структурированное описание методов сервиса.
### Установка Docker
___
https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository

### Основные команды запуска
___
* Сборка контейнеров::
    `$ docker-compose -f local.yml build`
* Запуск контейнеров::
    `$ docker-compose -f local.yml up`
* Сервер доступен по адресу
```sh
http://localhost:8010/
```

### Описание URL Api
___
| URL | Метод | Описание |
| ------ | ------ | ------ |
| /api/kernel/ | GET | Выдает список из 10 задач, которые отсортированы по убыванию|
| /api/kernel/ | POST | Отавляет запрос на запуск задачи. Принимает три параметра в формате JSON: - date_start (YYYY-MM-DD); - date_fin (YYYY-MM-DD); -lag (int)|
| /api/kernel/<str:task_id> | GET | Принимает id задачи, выдает задачу со списком расчетов, если расчет не завершен, то выдает null|

## Иные возможности микросервиса
___
* В Docker разворачивается также дашбоард Flower отслеживания всех выполняемых задач Celery
Доступен по адресу:
```sh
http://localhost:5557/
```
* Подготовлен .yml файл для CI GitHub Actions
> Выполняет проверку тестов
> Проверяет форматирование кода, через black
> Выводит отчет по покрытию тестами
